(window.webpackJsonp=window.webpackJsonp||[]).push([[16,15,22],{406:function(e,t,n){"use strict";n.d(t,"b",(function(){return c})),n.d(t,"a",(function(){return l}));var r=n(167),o=n(168),c=(n(31),function(){function e(t){Object(r.a)(this,e),this.pngToLabel=t}return Object(o.a)(e,[{key:"encode",value:function(object){return console.log({toencode:object}),{flipX:object.flipX,flipY:object.flipY,top:object.top,left:object.left,angle:object.angle,scaleX:object.scaleX,scaleY:object.scaleY,width:object.width,height:object.height,src:this.pngToLabel[object.src]}}}]),e}()),l=function(){function e(t){Object(r.a)(this,e),this.labelToPng=t}return Object(o.a)(e,[{key:"_decode",value:function(object){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,t=JSON.parse(JSON.stringify(object));t.flipX=object.flipX,t.flipY=object.flipY,t.top=object.top*e,t.left=object.left*e,t.angle=object.angle,t.scaleX=object.scaleX*e,t.scaleY=object.scaleY*e,t.width=object.width,t.height=object.height,t.src=this.labelToPng[object.src]}},{key:"decode",value:function(object){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,t=JSON.parse('{"type":"image","version":"5.3.0","originX":"left","originY":"top","left":396.78,"top":191.9,"width":473,"height":528,"fill":"rgb(0,0,0)","stroke":null,"strokeWidth":0,"strokeDashArray":null,"strokeLineCap":"butt","strokeDashOffset":0,"strokeLineJoin":"miter","strokeUniform":false,"strokeMiterLimit":4,"scaleX":0.29,"scaleY":0.29,"angle":345.56,"flipX":false,"flipY":false,"opacity":1,"shadow":null,"visible":true,"backgroundColor":"","fillRule":"nonzero","paintFirst":"fill","globalCompositeOperation":"source-over","skewX":0,"skewY":0,"cropX":0,"cropY":0,"crossOrigin":null,"filters":[]}');return t.flipX=object.flipX,t.flipY=object.flipY,t.top=object.top*e,t.left=object.left*e,t.angle=object.angle,t.scaleX=object.scaleX*e,t.scaleY=object.scaleY*e,t.width=object.width,t.height=object.height,t.src=this.labelToPng[object.src],t}}]),e}()},407:function(e,t,n){var content=n(413);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(101).default)("403a5475",content,!0,{sourceMap:!1})},410:function(e,t,n){"use strict";n.r(t);var r,o,c,l,d,h,f,v,m,y,w,O=n(12),x=n(103),_=n(2),j=(n(54),n(164),n(31),n(62),n(16),n(26),n(449),n(102),n(46),n(47),n(411),n(243),n(450)),k=n(3),R=n(81),I=n(406),A=k.c.div(r||(r=Object(_.a)(["\n  display: flex;\n  flex-direction: column;\n  max-width: 90vw;\n  gap: 8px;\n"]))),U=k.c.div(o||(o=Object(_.a)(["\n  width: 100%;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n"]))),E=Object(k.c)("div",{disabled:Boolean})(c||(c=Object(_.a)(["\n  text-align: center;\n  padding: 12px 20px;\n  border: 1px solid;\n  border-color: ",";\n  border-radius: 12px;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  cursor: ",";\n  opacity: ",";\n"])),(function(e){return e.theme.text1}),(function(e){return e.disabled?"not-allowed":"pointer"}),(function(e){return e.disabled?"0.5":"1"})),C={components:{Wrapper:A,UploaderWrapper:U,Uploader:Object(k.c)(E)(l||(l=Object(_.a)(["\n\n"]))),UndoRedoWrapper:k.c.div(d||(d=Object(_.a)(["\n  overflow: auto;\n  width: 100%;\n"]))),UndoRedoButton:Object(k.c)(E)(h||(h=Object(_.a)(["\n  border-color: ",";\n  float: left;\n  min-height: 60px;\n  max-height: 60px;\n  margin-right: 16px;\n  width: calc(25% - 12px);\n  transition: background-color .1s ease-in;\n\n  &:hover {\n    background-color: ",";\n  }\n\n  &:last-child {\n    border-color: ",";\n    width: calc(50% - 12px);\n    margin-right: 0;\n\n    &:hover {\n      background-color: ",";\n    }\n  }\n\n  img {\n    max-width: 30px;\n    height: auto;\n    width: auto;\n  }\n"])),(function(e){return e.theme.text3}),(function(e){var t=e.disabled,n=e.theme;return!t&&Object(R.c)(.9,n.text3)}),(function(e){return e.theme.red1}),(function(e){var t=e.disabled,n=e.theme;return!t&&Object(R.c)(.9,n.red1)})),Controls:k.c.div(f||(f=Object(_.a)(["\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n"]))),Overlays:k.c.div(v||(v=Object(_.a)(["\n  overflow: auto;\n  width: 100%;\n"]))),AddHatButton:Object(k.c)(E)(m||(m=Object(_.a)(["\n  border-color: ",";\n  float: left;\n  min-height: 60px;\n  max-height: 60px;\n  margin-right: 14px;\n  width: calc((100% - ","px)/5 - 1px);\n  transition: background-color .1s ease-in;\n\n  &:hover {\n    background-color: ",";\n  }\n\n  &:last-child {\n    margin-right: 0;\n  }\n\n  img {\n    max-width: 30px;\n    height: auto;\n    width: auto;\n  }\n"])),(function(e){return e.theme.blue1}),51.2,(function(e){var t=e.disabled,n=e.theme;return!t&&Object(R.c)(.85,n.blue1)})),DownloadButton:Object(k.c)(E)(y||(y=Object(_.a)(["\n  border-color: ",";\n"])),(function(e){return e.theme.yellow1})),EditCanvas:Object(k.c)("canvas",{disabled:Boolean})(w||(w=Object(_.a)(["\n  border: 1px dashed ",";\n  opacity: ",";\n  max-width: 90vw;\n  width: 100%;\n  height: 300px;\n"])),(function(e){return e.theme.text1}),(function(e){return e.disabled?"0.7":"1"}))},props:{historyIndex:{type:Number,default:null},historyLength:{type:Number,default:null},nonAddControlsAbove:{type:Boolean,default:!1},canvasId:{type:String,default:"canvas"},dataURI:{type:String,default:null},current:{type:String,default:null},labelToUri:{type:Object,default:null},uriToLabel:{type:Object,default:null}},data:function(){return{objectEncoder:null,objectDecoder:null,currentlySelected:null,ready:!1,__canvas:null,latestManualUpdate:null}},computed:{undoDisabled:function(){return!this.ready||(!("number"==typeof this.historyIndex&&"number"==typeof this.historyLength&&this.historyIndex>=0)||this.historyIndex<=0)},redoDisabled:function(){return!this.ready||(!("number"==typeof this.historyIndex&&"number"==typeof this.historyLength&&this.historyIndex>=0)||this.historyIndex===this.historyLength-1)},removeAllOverlaysDisabled:function(){return!this.ready||0===this.totalObjects},totalObjects:function(){if(this.current)return JSON.parse(this.current).length},undoText:function(){return"Undo"+(this.$isMobile()?"":" (U)")},redoText:function(){return"Redo"+(this.$isMobile()?"":" (R)")},removeAllOverlaysText:function(){return"Remove All Overlays"+(this.$isMobile()?"":" (X)")}},watch:{dataURI:function(){this.init()},current:function(){console.log("current() watcher called"),this.ready&&this.current!==this.getCurrentCanvasDataStr()?this.applyCurrentObjects("current changed"):console.log("skipping update, not ready or same canvas string")}},methods:{applyCurrentObjects:function(e){var t,n=this;console.log("applyCurrentObjects called",JSON.parse(this.current).length,"from",e),(t=this.__canvas).remove.apply(t,Object(x.a)(this.__canvas.getObjects())),this.__canvas.renderAll();var r=JSON.parse(this.current).map((function(e){return n.objectDecoder.decode(e)}));console.log("Enlivening"+r.length),j.fabric.util.enlivenObjects(r,(function(e){var t=canvas.renderOnAddRemove;n.__canvas.renderOnAddRemove=!1,e.forEach((function(e){n.__canvas.add(e)})),n.__canvas.renderOnAddRemove=t,n.__canvas.renderAll(),console.log(n.__canvas.getObjects().length)}))},deselectAll:function(){var e,t;null===(e=this.__canvas)||void 0===e||e.discardActiveObject(),null===(t=this.__canvas)||void 0===t||t.requestRenderAll()},cloneSelected:function(){var e=this;console.log("CloneSelected",this.__canvas.getActiveObject()),this.__canvas.getActiveObject().clone((function(t){t.set({left:e.__canvas.getActiveObject().left+10,top:e.__canvas.getActiveObject().top+10,evented:!0}),e.__canvas.discardActiveObject(),"activeSelection"===t.type?(t.canvas=e.__canvas,t.forEachObject((function(t){e.__canvas.add(t)})),t.setCoords()):e.__canvas.add(t),e.__canvas.setActiveObject(t),e.__canvas.requestRenderAll()}))},getPngUri:function(){return this.$refs[this.canvasId].$el.toDataURL("image/png")},getCurrentCanvasDataStr:function(){var e=this,t=this.__canvas.getObjects().map((function(e){return e.toJSON()})).map((function(t){return e.objectEncoder.encode(t)}));return JSON.stringify(t)},handleUpdate:function(e){var t=this.getCurrentCanvasDataStr();console.log("Sending ".concat(JSON.parse(t).length," objects from ").concat(e)),this.latestManualUpdate=t,this.$emit("updated",t)},undo:function(){this.ready&&this.$emit("undo")},redo:function(){this.ready&&this.$emit("redo")},removeAllOverlays:function(){var e;this.removeAllOverlaysDisabled||((e=this.__canvas).remove.apply(e,Object(x.a)(this.__canvas.getObjects())),this.__canvas.renderAll(),this.handleUpdate("removeAllOverlays"))},removeSelectedOverlays:function(){var e;(e=this.__canvas).remove.apply(e,Object(x.a)(this.currentlySelected)),this.__canvas.renderAll(),this.handleUpdate("removeSelectedOverlays")},download:function(){this.ready&&(this.__canvas&&(this.__canvas.selection=!1),this.__canvas.renderAll(),this.$refs.canvas.$el.toBlob((function(e){var t=URL.createObjectURL(e),link=document.createElement("a");link.download="hatted.png",link.href=t,document.body.appendChild(link),link.click(),URL.revokeObjectURL(t),link.remove()}),"image/png"))},init:function(){var e=this;if(this.ready=!1,this.dataURI){this.__canvas&&(this.__canvas.clear(),this.__canvas.dispose());var t=this,canvas=this.__canvas=new j.fabric.Canvas(this.canvasId,{selection:!0,width:t.$refs.canvas.$el.offsetWidth});this.__canvas.selection=!1,this.__canvas.on("object:modified",(function(){e.handleUpdate("object:modified")})),this.__canvas.on("mouse:dblclick",(function(){return e.cloneSelected()})),this.__canvas.on("selection:created",(function(n){e.currentlySelected=n.selected,n.selected.forEach((function(e){return e.bringToFront()})),t.handleUpdate("selection:created")})),this.__canvas.on("selection:updated",(function(n){e.currentlySelected=n.selected,n.selected.forEach((function(e){return e.bringToFront()})),t.handleUpdate("selection:updated")})),this.__canvas.on("selection:cleared",(function(t){e.currentlySelected=null})),j.fabric.Image.fromURL(this.dataURI,(function(img){var e=img.height/img.width,n=canvas.width,r=Math.floor(parseInt(t.$refs.canvas.$el.style.width)*e);canvas.setHeight(r),t.$emit("latestWidth",n),canvas.setBackgroundImage(img,canvas.renderAll.bind(canvas),{scaleX:canvas.width/img.width,scaleY:canvas.height/img.height}),t.reloadHatMaf()}))}},reloadHatMaf:function(){var e=this,canvas=this.__canvas,img=document.createElement("img");img.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='utf-8'%3F%3E%3C!DOCTYPE svg PUBLIC '-//W3C//DTD SVG 1.1//EN' 'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3E%3Csvg version='1.1' id='Ebene_1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' width='595.275px' height='595.275px' viewBox='200 215 230 470' xml:space='preserve'%3E%3Ccircle style='fill:%23F44336;' cx='299.76' cy='439.067' r='218.516'/%3E%3Cg%3E%3Crect x='267.162' y='307.978' transform='matrix(0.7071 -0.7071 0.7071 0.7071 -222.6202 340.6915)' style='fill:white;' width='65.545' height='262.18'/%3E%3Crect x='266.988' y='308.153' transform='matrix(0.7071 0.7071 -0.7071 0.7071 398.3889 -83.3116)' style='fill:white;' width='65.544' height='262.179'/%3E%3C/g%3E%3C/svg%3E",j.fabric.Object.prototype.transparentCorners=!1,j.fabric.Object.prototype.cornerColor="blue",j.fabric.Object.prototype.cornerStyle="circle";var t=function(img){var e=.5*canvas.width,t=.5*canvas.height,n=e/img.width,r=t/img.height,o=Math.min(n,r);img.scale(o),img.set({left:(canvas.width-img.getScaledWidth())/2,top:(canvas.height-img.getScaledHeight())/2,originX:"left",originY:"top"}),canvas.add(img).renderAll().setActiveObject(img)},n=function(){var n=Object(O.a)(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e.ready){n.next=2;break}return n.abrupt("return");case 2:new j.fabric.Image.fromURL(e.labelToUri.hat,t);case 3:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}(),r=function(){var n=Object(O.a)(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e.ready){n.next=2;break}return n.abrupt("return");case 2:new j.fabric.Image.fromURL(e.labelToUri.dog,t);case 3:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}(),o=function(){var n=Object(O.a)(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e.ready){n.next=2;break}return n.abrupt("return");case 2:new j.fabric.Image.fromURL(e.labelToUri.shark,t);case 3:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}(),c=function(){var n=Object(O.a)(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e.ready){n.next=2;break}return n.abrupt("return");case 2:new j.fabric.Image.fromURL(e.labelToUri.cat,t);case 3:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}(),l=function(){var n=Object(O.a)(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e.ready){n.next=2;break}return n.abrupt("return");case 2:console.log(e.labelToUri.redacted),new j.fabric.Image.fromURL(e.labelToUri.redacted,t);case 4:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();j.fabric.Object.prototype.controls.deleteControl=new j.fabric.Control({x:.5,y:-.5,offsetY:16,cursorStyle:"pointer",mouseUpHandler:function(t,n){var r=n.target,canvas=r.canvas;canvas.remove(r),canvas.requestRenderAll(),e.handleUpdate("deleteObject")},render:function(e,t,n,r,o){var c=this.cornerSize;e.save(),e.translate(t,n),e.rotate(j.fabric.util.degreesToRadians(o.angle)),e.drawImage(img,-c/2,-c/2,c,c),e.restore()},cornerSize:24}),e.$refs.addHatBtn.$el.onclick=function(){n()},e.$refs.addDogBtn.$el.onclick=function(){r()},e.$refs.addSharkBtn.$el.onclick=function(){o()},e.$refs.addCatBtn.$el.onclick=function(){c()},e.$refs.addRedactedBtn.$el.onclick=function(){l()},e.ready=!0,e.applyCurrentObjects("fabric.Image.fromURL")}},mounted:function(){this.objectEncoder=new I.b(this.uriToLabel),this.objectDecoder=new I.a(this.labelToUri),this.init()}},D=C,L=(n(412),n(19)),component=Object(L.a)(D,(function(){var e=this,t=e._self._c;return t("Wrapper",[e.nonAddControlsAbove?e._e():t("UndoRedoWrapper",[t("UndoRedoButton",{attrs:{disabled:e.undoDisabled},on:{click:e.undo}},[e._v(e._s(e.undoText))]),e._v(" "),t("UndoRedoButton",{attrs:{disabled:e.redoDisabled},on:{click:e.redo}},[e._v(e._s(e.redoText))]),e._v(" "),t("UndoRedoButton",{attrs:{disabled:e.removeAllOverlaysDisabled},on:{click:e.removeAllOverlays}},[e._v(e._s(e.removeAllOverlaysText))])],1),e._v(" "),t("div",{directives:[{name:"click-outside",rawName:"v-click-outside",value:e.deselectAll,expression:"deselectAll"}]},[t("EditCanvas",{ref:"canvas",staticStyle:{"border-radius":"14px"},attrs:{disabled:!e.ready,id:e.canvasId}})],1),e._v(" "),e.nonAddControlsAbove?t("UndoRedoWrapper",[t("UndoRedoButton",{attrs:{disabled:e.undoDisabled},on:{click:e.undo}},[e._v(e._s(e.undoText))]),e._v(" "),t("UndoRedoButton",{attrs:{disabled:e.redoDisabled},on:{click:e.redo}},[e._v(e._s(e.redoText))]),e._v(" "),t("UndoRedoButton",{attrs:{disabled:e.removeAllOverlaysDisabled},on:{click:e.removeAllOverlays}},[e._v(e._s(e.removeAllOverlaysText))])],1):e._e(),e._v(" "),t("Controls",[t("Overlays",[t("AddHatButton",{ref:"addHatBtn",attrs:{disabled:!e.ready}},[t("img",{attrs:{src:"/overlays/hat.png"}})]),e._v(" "),t("AddHatButton",{ref:"addDogBtn",attrs:{disabled:!e.ready}},[t("img",{attrs:{src:"/overlays/dog.png"}})]),e._v(" "),t("AddHatButton",{ref:"addSharkBtn",attrs:{disabled:!e.ready}},[t("img",{attrs:{src:"/overlays/shark.png"}})]),e._v(" "),t("AddHatButton",{ref:"addCatBtn",attrs:{disabled:!e.ready}},[t("img",{attrs:{src:"/overlays/cat.png"}})]),e._v(" "),t("AddHatButton",{ref:"addRedactedBtn",attrs:{disabled:!e.ready}},[t("img",{attrs:{src:"/overlays/redacted.png"}})])],1)],1)],1)}),[],!1,null,"7495358a",null);t.default=component.exports},412:function(e,t,n){"use strict";n(407)},413:function(e,t,n){var r=n(100)((function(i){return i[1]}));r.push([e.i,".controls[data-v-7495358a]{display:inline-block}",""]),r.locals={},e.exports=r},439:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(12);n(54),n(16),n(62),n(31),n(26);function o(e){return new Promise((function(t,n){var img=new Image;img.onload=function(){t({width:img.width,height:img.height})},img.onerror=n,img.src=e}))}var c=function(){var e=Object(r.a)(regeneratorRuntime.mark((function e(t,n,r,c){var l,d,h,canvas,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o(t);case 2:return l=e.sent,d=l.width,h=l.height,canvas=new fabric.Canvas(null,{width:d,height:h}),f=d/r,e.next=9,new Promise((function(e,n){fabric.Image.fromURL(t,(function(img){canvas.setBackgroundImage(img,(function(){canvas.renderAll(),e()}),{scaleX:d/img.width,scaleY:h/img.height})}),{crossOrigin:"anonymous"})}));case 9:return e.next=11,new Promise((function(e,t){var r=JSON.parse(n).map((function(e){return c.decode(e,f)}));console.log({ratio:f,objects:r}),fabric.util.enlivenObjects(r,(function(t){t.forEach((function(e){canvas.add(e)})),canvas.renderAll(),e()}))}));case 11:return e.abrupt("return",canvas.lowerCanvasEl.toDataURL());case 12:case"end":return e.stop()}}),e)})));return function(t,n,r,o){return e.apply(this,arguments)}}()},440:function(e,t,n){"use strict";n(414),n(16),n(415),n(416),n(417),n(418),n(419),n(420),n(421),n(422),n(423),n(424),n(425),n(426),n(427),n(428),n(429),n(430),n(431),n(432),n(433),n(434),n(435),n(436),n(437),n(438),n(46),n(47),n(411),n(243);t.a=function(e,t){var n;n=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):unescape(e.split(",")[1]);for(var r=e.split(",")[0].split(":")[1].split(";")[0],o=new Uint8Array(n.length),i=0;i<n.length;i++)o[i]=n.charCodeAt(i);var c=new Blob([o],{type:r}),l=URL.createObjectURL(c),link=document.createElement("a");link.download=t,link.href=l,document.body.appendChild(link),link.click(),URL.revokeObjectURL(l),link.remove()}},443:function(e,t,n){var content=n(462);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(101).default)("28dd3e88",content,!0,{sourceMap:!1})},451:function(e,t){},452:function(e,t){},453:function(e,t){},455:function(e,t,n){"use strict";n.r(t);var r,o,c=n(2),l=n(3),d=Object(l.d)(r||(r=Object(c.a)(["\n  from {\n    transform: rotate(0deg);\n  }\n  to {\n    transform: rotate(360deg);\n  }\n"]))),h={components:{StyledSVG:Object(l.c)("svg",{size:String,stroke:String})(o||(o=Object(c.a)(["\n  animation: 2s "," linear infinite;\n  height: ",";\n  width: ",";\n  path {\n    stroke: ",";\n  }\n"])),d,(function(e){return e.size}),(function(e){return e.size}),(function(e){var t=e.stroke,n=e.theme;return t||n.primary1}))},props:{size:{type:String,default:"16px"},stroke:{type:String,default:null}}},f=n(19),component=Object(f.a)(h,(function(){var e=this,t=e._self._c;return t("StyledSVG",{attrs:{viewBox:"0 0 24 24",fill:"none",size:e.size,stroke:e.stroke}},[t("path",{attrs:{d:"M12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22C17.5228 22 22 17.5228 22 12C22 9.27455 20.9097 6.80375 19.1414 5","stroke-width":"2.5","stroke-linecap":"round","stroke-linejoin":"round"}})])}),[],!1,null,null,null);t.default=component.exports},461:function(e,t,n){"use strict";n(443)},462:function(e,t,n){var r=n(100)((function(i){return i[1]}));r.push([e.i,".controls[data-v-d878ef6a]{display:inline-block}",""]),r.locals={},e.exports=r},475:function(e,t,n){"use strict";n.r(t);var r,o,c,l,d,h,f,v,m,y,w,O,x,_,j=n(103),k=n(12),R=n(2),I=(n(54),n(3)),A=n(43),U=(n(414),n(16),n(415),n(416),n(417),n(418),n(419),n(420),n(421),n(422),n(423),n(424),n(425),n(426),n(427),n(428),n(429),n(430),n(431),n(432),n(433),n(434),n(435),n(436),n(437),n(438),n(472)),E=function(){var e=Object(k.a)(regeneratorRuntime.mark((function e(t){var n,r,o,c,l,i,d,h,f,v,m,canvas,y;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=[],r=t.split(",")[1],o=window.atob(r),c=o.length,l=new Uint8Array(c),i=0;i<c;i++)l[i]=o.charCodeAt(i);for(d=new U.GifReader(l),h=d.numFrames(),f=[],canvas=document.createElement("canvas"),i=0;i<h;i++)y=d.frameInfo(i),n.push(y.delay),0==i&&(canvas.width=y.width,canvas.height=y.height,m=canvas.getContext("2d")||new CanvasRenderingContext2D,v=m.createImageData(y.width,y.height)),d.decodeAndBlitFrameRGBA(i,v.data),m.putImageData(v,0,0),f.push(canvas.toDataURL("image/png"));return console.log({pngUris:f,delays:n}),e.abrupt("return",{pngUris:f,delays:n});case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),C=(n(46),n(47),n(62),n(473)),D=n(439),L=function(){var e=Object(k.a)(regeneratorRuntime.mark((function e(t,n,r,o){var c,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:c=[],i=0;case 2:if(!(i<t.length)){e.next=11;break}return e.t0=c,e.next=6,Object(D.a)(t[i],n[i],r,o);case 6:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 8:i++,e.next=2;break;case 11:return e.abrupt("return",c);case 12:case"end":return e.stop()}}),e)})));return function(t,n,r,o){return e.apply(this,arguments)}}(),S=function(){var e=Object(k.a)(regeneratorRuntime.mark((function e(t,n,r,o,c){var l,d,h,canvas,f,v,m,y,w,O,x,data,_,i,j,k,output,R,I;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L(t,n,o,c);case 2:return l=e.sent,d=function(e){return new Promise((function(t,n){var img=new Image;img.onload=function(){return t(img)},img.onerror=n,img.src=e}))},e.next=6,Promise.all(l.map((function(e){return d(e)})));case 6:for(h=e.sent,canvas=document.createElement("canvas"),f=canvas.getContext("2d"),v=h[0].width,m=h[0].height,console.log({w:o}),canvas.width=v,canvas.height=m,y=h.map((function(img){return f.clearRect(0,0,canvas.width,canvas.height),f.drawImage(img,0,0),f.getImageData(0,0,canvas.width,canvas.height)})),w=y[0],O=w.width,x=w.height,data=y.map((function(e){return new Uint8Array(e.data)})),_=Object(C.GIFEncoder)(),i=0;i<data.length;i++)j=Object(C.quantize)(data[i],256,{format:"rgb444"}),k=Object(C.applyPalette)(data[i],j),console.log(r[i]),_.writeFrame(k,O,x,{palette:j,delay:10*r[i]});return _.finish(),output=_.bytes(),R=output.reduce((function(e,t){return e+String.fromCharCode(t)}),""),I="data:image/gif;base64,".concat(btoa(R)),e.abrupt("return",I);case 25:case"end":return e.stop()}}),e)})));return function(t,n,r,o,c){return e.apply(this,arguments)}}(),T=n(1),B=n(130),P=n(440),$=n(165),W=n(406),N={EDIT_LOADING:"EDIT_LOADING",EDIT:"EDIT",PREVIEW_LOADING:"PREVIEW_LOADING",PREVIEW:"PREVIEW"},F=I.c.div(r||(r=Object(R.a)(["\n  display: flex;\n  flex-direction: column;\n  max-width: 90vw;\n  gap: 8px;\n"]))),G=Object(I.c)("div",{disabled:Boolean})(o||(o=Object(R.a)(["\n  padding: 12px 20px;\n  border: 1px solid;\n  border-color: ",";\n  border-radius: 12px;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  cursor: ",";\n  opacity: ",";\n"])),(function(e){return e.theme.text1}),(function(e){return e.disabled?"not-allowed":"pointer"}),(function(e){return e.disabled?"0.5":"1"})),Y=Object(I.c)(G)(c||(c=Object(R.a)(["\n  border-color: ",";\n"])),(function(e){return e.theme.yellow1})),X=I.c.div(l||(l=Object(R.a)(["\n  padding: 20px;\n  display: flex;\n  gap: 12px;\n  justify-content: center;\n  align-items: center;\n  flex-direction: column;\n  border-radius: 20px;\n  border: 1px solid ",";\n"])),(function(e){return e.theme.bg5})),V=Object(I.c)(X)(d||(d=Object(R.a)(["\n  padding: 0;\n  gap: 0;\n"]))),M=I.c.div(h||(h=Object(R.a)(["\n  cursor: pointer;\n  text-decoration: underline;\n  padding: 20px;\n"]))),H=I.c.div(f||(f=Object(R.a)(["\n\n"]))),J=Object(I.c)(B.RowBetween)(v||(v=Object(R.a)(["\n\n"]))),z=Object(I.c)(G)(m||(m=Object(R.a)(["\n  text-decoration: underline;\n  cursor: pointer;\n  padding-left: 12px;\n  padding-right: 12px;\n"]))),K=I.c.div(y||(y=Object(R.a)(["\n  font-weight: 800;\n"]))),Z={components:{Wrapper:F,PreviewButton:Y,LoadingWrapper:X,CompleteWrapper:V,BackToEdit:M,Navigator:H,ArrowDisplayRow:J,ArrowButton:z,LeftArrowIcon:Object(I.c)($.c)(w||(w=Object(R.a)(["\n\n"]))),IndexDisplay:K,RightArrowIcon:Object(I.c)($.d)(O||(O=Object(R.a)(["\n\n"]))),CopyPreviousOverlaysButton:Object(I.c)(G)(x||(x=Object(R.a)(["\n  width: 100%;\n  text-align: center;\n"]))),DownloadButton:Object(I.c)(G)(_||(_=Object(R.a)(["\n  margin: 20px;\n  width: 90%;\n  border-color: ",";\n"])),(function(e){return e.theme.yellow1}))},props:{dataURI:{type:String,default:null},labelToUri:{type:String,default:null},uriToLabel:{type:String,default:null}},data:function(){return{Views:N,latestWidth:null,view:N.EDIT_LOADING,gifPngUris:null,delays:null,latestFrames:null,previewGifUri:null}},computed:{clonePreviousDisabled:function(){return 0===this.frameIndex||this.getPreviousFrameOverlays()===this.getOverlays()},historyLength:function(){if(console.log(this.$store.state.gif.history[this.frameIndex]),this.frameIndex>=0&&this.$store.state.gif.history[this.frameIndex])return this.$store.state.gif.history[this.frameIndex].length},historyIndex:function(){return this.allFrameHistoryIndices[this.frameIndex]},allFrameHistoryIndices:function(){return this.$store.state.gif.historyIndex},frameIndex:function(){return this.$store.state.gif.frameIndex},totalFrames:function(){return this.$store.state.gif.history.length},clonePreviousText:function(){return"Clone previous frame overlays"+(this.$isMobile()?"":" (C)")}},methods:{setLatestWidth:function(e){this.latestWidth=e},getOverlays:function(){return this.$store.getters[A.a.GET_OVERLAYS_FOR_CURRENT_FRAME]},getPreviousFrameOverlays:function(){return this.$store.getters[A.a.GET_OVERLAYS_FOR_PREVIOUS_FRAME]},getPngURI:function(e){return this.gifPngUris[e]},handlePreviousClicked:function(){this.frameIndex>0&&this.$store.commit(A.b.FRAME_INDEX,this.frameIndex-1)},handleNextClicked:function(){this.frameIndex<this.$store.state.gif.history.length-1&&this.$store.commit(A.b.FRAME_INDEX,this.frameIndex+1)},handleUpdate:function(e){var t=this.frameIndex;this.$store.commit(A.b.UPDATE,{frameIndex:t,canvasState:e}),this.latestFrames[t]=this.$refs.editor.getPngUri()},undo:function(){this.$store.commit(A.b.UNDO)},redo:function(){this.$store.commit(A.b.REDO)},removeAllOverlays:function(){this.$refs.editor.removeAllOverlays()},removeSelectedOverlays:function(){this.$refs.editor.removeSelectedOverlays()},copyPreviousFrameOverlays:function(){if(this.frameIndex>0&&!this.clonePreviousDisabled){var e=this.getPreviousFrameOverlays();this.handleUpdate(e)}},handlePreviewClicked:function(){var e=this;return Object(k.a)(regeneratorRuntime.mark((function t(){var n,r,o,c;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.view=N.PREVIEW_LOADING,console.log("Running conversion"),n=e.gifPngUris,r=e.$store.getters[A.a.GET_ALL_CURRENT_OVERLAYS],o=e.delays,t.next=7,S(n,r,o,e.latestWidth,new W.a(e.labelToUri));case 7:c=t.sent,e.previewGifUri=c,e.view=N.PREVIEW;case 10:case"end":return t.stop()}}),t)})))()},download:function(){this.previewGifUri&&Object(P.a)(this.previewGifUri,"hatted.gif")}},mounted:function(){var e=this;return Object(k.a)(regeneratorRuntime.mark((function t(){var n,r,o,c;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,E(e.dataURI);case 2:n=t.sent,r=n.pngUris,o=n.delays,c=r.length,T.default.set(e,"gifPngUris",Object(j.a)(r)),T.default.set(e,"latestFrames",Object(j.a)(r)),T.default.set(e,"delays",o),e.$store.commit(A.b.RESET,c),e.keyboardHandler=function(t){if(t.ctrlKey||t.metaKey)"z"!==t.key||t.shiftKey?("z"===t.key&&t.shiftKey||"Z"===t.key&&t.shiftKey)&&e.redo():e.undo();else if(t.shiftKey)if("ArrowLeft"===t.key)for(var i=0;i<10;i++)e.handlePreviousClicked();else if("ArrowRight"===t.key)for(var n=0;n<10;n++)e.handleNextClicked();switch(t.key){case"Backspace":console.log("Backspace key pressed"),e.removeSelectedOverlays();break;case"ArrowLeft":console.log("Left Arrow key pressed"),e.handlePreviousClicked();break;case"ArrowRight":console.log("Right Arrow key pressed"),e.handleNextClicked();break;case"u":console.log("U key pressed"),e.undo();break;case"r":console.log("R key pressed"),e.redo();break;case"x":console.log("D key pressed"),e.removeAllOverlays();break;case"c":console.log("C key pressed"),e.copyPreviousFrameOverlays()}},window.addEventListener("keydown",e.keyboardHandler),e.view=N.EDIT;case 13:case"end":return t.stop()}}),t)})))()},beforeDestroy:function(){window.removeEventListener("keydown",this.keyboardHandler)}},Q=(n(461),n(19)),component=Object(Q.a)(Z,(function(){var e=this,t=e._self._c;return t("div",[e.view===e.Views.EDIT_LOADING?t("Wrapper",[t("LoadingWrapper",[t("Loader"),e._v(" "),t("div",[e._v("Loading GIF")])],1)],1):e.view===e.Views.EDIT?t("Wrapper",[t("Navigator",[t("ArrowDisplayRow",[t("ArrowButton",{attrs:{disabled:0===e.frameIndex},on:{click:e.handlePreviousClicked}},[t("LeftArrowIcon")],1),e._v(" "),t("IndexDisplay",[e._v(e._s(e.frameIndex+1)+"/"+e._s(e.totalFrames))]),e._v(" "),t("ArrowButton",{attrs:{disabled:e.frameIndex===e.totalFrames-1},on:{click:e.handleNextClicked}},[t("RightArrowIcon")],1)],1)],1),e._v(" "),t("CopyPreviousOverlaysButton",{attrs:{disabled:e.clonePreviousDisabled},on:{click:e.copyPreviousFrameOverlays}},[e._v(e._s(e.clonePreviousText))]),e._v(" "),t("Editor",{ref:"editor",attrs:{nonAddControlsAbove:!0,dataURI:e.getPngURI(e.frameIndex),current:e.getOverlays(),labelToUri:e.labelToUri,uriToLabel:e.uriToLabel,historyIndex:e.historyIndex,historyLength:e.historyLength},on:{latestWidth:e.setLatestWidth,updated:e.handleUpdate,undo:e.undo,redo:e.redo}}),e._v(" "),t("PreviewButton",{on:{click:e.handlePreviewClicked}},[e._v("Preview GIF 📀")])],1):e.view===e.Views.PREVIEW_LOADING?t("Wrapper",[t("LoadingWrapper",[t("Loader"),e._v(" "),t("div",[e._v("Loading Preview")])],1)],1):e.view===e.Views.PREVIEW?t("CompleteWrapper",[t("BackToEdit",{on:{click:function(t){e.view=e.Views.EDIT}}},[e._v("Back to edit")]),e._v(" "),t("img",{staticStyle:{width:"500px","max-width":"100%",height:"auto"},attrs:{src:e.previewGifUri}}),e._v(" "),t("DownloadButton",{on:{click:e.download}},[e._v("Download 👇")])],1):e._e()],1)}),[],!1,null,"d878ef6a",null);t.default=component.exports;installComponents(component,{Loader:n(455).default,Editor:n(410).default})}}]);